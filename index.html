<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h3>WTF</h3>
    <!-- <script src="./iterable/each.js"></script> -->
    <!-- <script src="./iterable/this.js"></script> -->
    <!-- <script src="./others/sum.js"></script> -->
    <!-- <script src="./others/binaryTree.js"></script> -->
    <!-- <script src="./others/scheduler.js"></script> -->
    <!-- <script src="./others/chineseToPinyin.js"></script> -->
    <!-- <script src="./arithmetic/objectFlattening.js"></script> -->
    <!-- <script src="./arithmetic/unaryPlus.js"></script> -->
    <!-- <script src="./arithmetic/hashMap.js"></script> -->
    <!-- <script src="./arithmetic/test.js"></script> -->
    <!-- <script src="./others/deepClone.js"></script> -->
    <!-- <script src="./others/binaryTree.js"></script> -->
    <!-- <script src="./others/sort.js"></script> -->
    <!-- <script src="./others/multiRequest.js"></script> -->
    <script src="./others/nonRepeat.js"></script>
    <!-- <script>
        const tree = new BST()
        tree.add(10)
        tree.add(1)
        tree.add(8)
        tree.add(2)
        tree.add(3)
        tree.add(12)
        tree.add(-3)
        tree.print()
    </script> -->
    <script>
        const p = new Promise((resolve, reject) => {
            console.log('step-1')
            // setTimeout(() => {
            //     console.log('step-5')
            /**
             * 即使是同步，then依赖还是会放到事件循环的最后执行
             * 回调是放进宏任务队列 | 微任务队列?
             * 默认: 微任务队列
             * 手动实现：使用setTimeout放入宏任务列队
             * 微任务队列实现：MutationObserver 构造函数
             */
            // reject('error catch')
            resolve('success cb')
            // }, 800)
        })

        console.log('step-2')

        // resolve执行，dispatch后状态变更，modify Subscribers

        const p1 = p.then(res => {
            console.log('step-6')
            return {res}
        })

        console.log('step-3')

        // 没有return [[PromiseResult]]: undefined
        // const p2 = p1.then(res => {
        //     console.log('step-7')
        //     console.log(res)
        // })

        // console.log(p2) // rejected

        // const p3 = p2.then(res => {
        //     console.log(res)
        //     throw new Error('sth wrong')
        // })
        // .then(res => {
        //     console.log(res)
        //     return Promise.reject('another thing wrong')
        // })
        // .catch(error => {
        //     console.log(error)
        // })
        // .then(res => {
        //     console.log(res)
        //     return Promise.reject('another thing wrong too')
        // })
        // .catch(error => {
        //     console.log(error)
        // })
        
        // console.log(p3) // fulfilled

        console.log('step-4')

        const errorP = p1.then(res => {
            throw new Error('error test')
        })

        console.log(errorP) // rejected

        const toP = errorP.catch(error => { // 捕获异常
            console.log(error)
        })

        console.log(toP) // fulfilled

        // start ----------------------
        function getPromise(data = {success: true}, time = 1000) {
            return new Promise(resolve => {
                setTimeout(() => {
                    return data
                }, time)
            })
        }
        const func1 = getPromise(1, 1000);
        const func2 = getPromise(2, 800);
        const func3 = getPromise(3, 500);
        [func1, func2, func3]
            .reduce((p, f) => p.then(f), Promise.resolve()) // 没有return 上一个的值，大哥?
            .then(result3 => {
                console.log(result3)
            })
        // end -------------------------

    </script>

    <script>
    //     // replace做了什么事？
    //     function format(value) {
    //         value = String(value)
    //         const result = parseInt(value.replace(/[^\d]/g, '').replace(/[-]/g, ''))
    //         console.log(result)
    //         return result
    //     }

    //     format('1a23')

    </script>
</body>

</html>
